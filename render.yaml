# ============================================
# ğŸš€ Render.com Configuration - WhatsApp Telegram Bot
# Ø§Ù„Ø¥ØµØ¯Ø§Ø±: 2.0.0 - Optimized for Production
# ============================================

services:
  # ============================================
  # ğŸ“± Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - WhatsApp Telegram Bot
  # ============================================
  - type: web
    name: whatsapp-telegram-bot
    runtime: docker
    repo: https://github.com/yourusername/whatsapp-telegram-bot
    region: frankfurt  # Ø£Ùˆ Ø£ÙŠ region Ù‚Ø±ÙŠØ¨ Ù…Ù†Ùƒ
    plan: starter  # Ø£Ùˆ professional Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙƒØ«Ù
    dockerfilePath: ./Dockerfile
    dockerContext: .
    
    # ============================================
    # ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡
    # ============================================
    buildCommand: |
      echo "ğŸš€ Ø¨Ø¯Ø¡ Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚..."
      npm ci --only=production
      echo "âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¨Ù†Ø§Ø¡"
    
    startCommand: node index.js
    
    # ============================================
    # âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±
    # ============================================
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: PUPPETEER_SKIP_CHROMIUM_DOWNLOAD
        value: true
      - key: PUPPETEER_EXECUTABLE_PATH
        value: /usr/bin/chromium-browser
      - key: DISABLE_SETUID_SANDBOX
        value: 1
      - key: NO_SANDBOX
        value: 1
      - key: MAX_OLD_SPACE_SIZE
        value: 4096
      - key: NODE_OPTIONS
        value: --max-old-space-size=4096
    
    # ============================================
    # ğŸ” Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ø­Ø³Ø§Ø³Ø© (ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡Ø§ ÙÙŠ Dashboard)
    # ============================================
    envVars:
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_ADMIN_IDS
        sync: false
      - key: DATABASE_URL
        sync: false
      - key: DATABASE_SSL
        value: true
      - key: SESSION_SECRET
        generateValue: true
      - key: ENCRYPTION_KEY
        generateValue: true
    
    # ============================================
    # ğŸ’¾ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†
    # ============================================
    disk:
      name: whatsapp-data
      mountPath: /app/data
      sizeGB: 10
    
    # ============================================
    # ğŸŒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©
    # ============================================
    healthCheckPath: /health
    numInstances: 1
    autoDeploy: true
    
    # ============================================
    # ğŸ”„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ±Ø¯Ø¯ÙŠ
    # ============================================
    routes:
      - type: rewrite
        source: /*
        destination: /
    
    # ============================================
    # ğŸ“Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
    # ============================================
    resources:
      memoryMB: 2048  # 2GB - Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù€ WhatsApp Web
      cpu: 2
      ephemeralStorageMB: 10240  # 10GB
    
    # ============================================
    # ğŸ” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
    # ============================================
    observability:
      logging:
        enabled: true
        retentionDays: 30
      metrics:
        enabled: true
      traces:
        enabled: true
    
    # ============================================
    # ğŸ›¡ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
    # ============================================
    security:
      http:
        forceHTTPS: true
        hsts:
          enabled: true
          maxAge: 31536000
          includeSubDomains: true
          preload: true
      headers:
        - name: X-Content-Type-Options
          value: nosniff
        - name: X-Frame-Options
          value: DENY
        - name: X-XSS-Protection
          value: 1; mode=block
    
    # ============================================
    # â° Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©
    # ============================================
    schedules:
      - name: daily-cleanup
        schedule: "0 3 * * *"  # ÙƒÙ„ ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¹Ø© 3 ØµØ¨Ø§Ø­Ø§Ù‹
        command: node scripts/cleanup.js
      - name: daily-report
        schedule: "0 9 * * *"  # ÙƒÙ„ ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¹Ø© 9 ØµØ¨Ø§Ø­Ø§Ù‹
        command: node scripts/daily-report.js
    
    # ============================================
    # ğŸš¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
    # ============================================
    alerts:
      - name: high-memory-usage
        type: metrics
        metric: memory_usage_percent
        threshold: 80
        duration: 5m
        channels:
          - email
          - slack
      - name: service-down
        type: health
        duration: 2m
        channels:
          - email
          - sms

# ============================================
# ğŸ—„ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - PostgreSQL
# ============================================
databases:
  - name: whatsapp-bot-db
    databaseName: whatsapp_bot
    user: whatsapp_bot_user
    region: frankfurt
    plan: starter  # Ø£Ùˆ professional Ù„Ù„Ø¥Ù†ØªØ§Ø¬
    
    # ============================================
    # ğŸ“ˆ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    # ============================================
    postgresql:
      version: "15"
    
    # ============================================
    # ğŸ”’ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
    # ============================================
    ipAllowList:
      - source: 0.0.0.0/0
        description: "Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¹Ø§Ù…"
    
    # ============================================
    # ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
    # ============================================
    backup:
      enabled: true
      schedule: "0 2 * * *"  # ÙƒÙ„ ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¹Ø© 2 ØµØ¨Ø§Ø­Ø§Ù‹
      retentionDays: 30
    
    # ============================================
    # ğŸ“Š Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
    # ============================================
    observability:
      metrics:
        enabled: true
      logs:
        enabled: true
        retentionDays: 30

# ============================================
# ğŸ“ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†
# ============================================
disks:
  - name: whatsapp-sessions
    mountPath: /app/sessions
    sizeGB: 5
    attachedTo:
      - whatsapp-telegram-bot
  
  - name: whatsapp-logs
    mountPath: /app/logs
    sizeGB: 2
    attachedTo:
      - whatsapp-telegram-bot
  
  - name: whatsapp-temp
    mountPath: /app/temp
    sizeGB: 3
    attachedTo:
      - whatsapp-telegram-bot

# ============================================
# ğŸ”— Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦ÙŠØ© Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©
# ============================================
env:
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  APP_NAME: "WhatsApp Telegram Bot"
  APP_VERSION: "2.0.0"
  APP_LANGUAGE: "ar"
  APP_TIMEZONE: "Asia/Riyadh"
  
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª WhatsApp
  WHATSAPP_VERSION: "2.0.0"
  WHATSAPP_USER_AGENT: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
  
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡
  MAX_SESSIONS_PER_USER: "5"
  MAX_MESSAGES_PER_DAY: "1000"
  MAX_GROUPS_PER_DAY: "50"
  
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
  SESSION_TIMEOUT: "3600"
  MAX_LOGIN_ATTEMPTS: "5"
  PASSWORD_MIN_LENGTH: "8"
  
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
  CLEANUP_INTERVAL: "86400"  # 24 Ø³Ø§Ø¹Ø©
  LOG_RETENTION_DAYS: "30"
  BACKUP_INTERVAL: "86400"  # 24 Ø³Ø§Ø¹Ø©

# ============================================
# ğŸ“¦ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ©
# ============================================
infrastructure:
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø¨ÙƒØ©
  network:
    type: public
    ipWhitelist:
      - 0.0.0.0/0
    
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙˆØ§Ø²Ù†
  loadBalancer:
    enabled: true
    type: round-robin
    stickySessions: true
    
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
  cache:
    enabled: true
    type: redis
    sizeMB: 100
    
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª CDN
  cdn:
    enabled: true
    provider: cloudflare

# ============================================
# ğŸ“ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø±
# ============================================
deploy:
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
  autoDeploy:
    enabled: true
    branch: main
    waitForChecks: true
    
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
  previews:
    enabled: true
    autoDestroy: true
    ttlHours: 24
    
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ±Ø§Ø¬Ø¹
  rollback:
    enabled: true
    automatic: true
    threshold: 5  # Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù„Ù„ØªØ±Ø§Ø¬Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
  tests:
    enabled: true
    command: npm test
    timeout: 300

# ============================================
# ğŸ” Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
# ============================================
monitoring:
  # Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø¯Ø§Ø¡
  performance:
    enabled: true
    metrics:
      - cpu
      - memory
      - disk
      - network
    
  # Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  application:
    enabled: true
    endpoints:
      - path: /health
        interval: 30
        timeout: 5
      - path: /status
        interval: 60
        timeout: 10
    
  # Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª
  logs:
    enabled: true
    retention: 30d
    filters:
      - level: error
      - level: warning
        
  # Ù…Ø±Ø§Ù‚Ø¨Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  database:
    enabled: true
    queries:
      slowQueryThreshold: 1000  # Ù…Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©
      trackConnections: true

# ============================================
# ğŸ›¡ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
# ============================================
security:
  # Ø¬Ø¯Ø±Ø§Ù† Ø§Ù„Ø­Ù…Ø§ÙŠØ©
  firewall:
    enabled: true
    rules:
      - port: 3000
        protocol: tcp
        source: 0.0.0.0/0
      - port: 5432
        protocol: tcp
        source: whatsapp-telegram-bot
    
  # ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  encryption:
    enabled: true
    algorithm: aes-256-gcm
    
  # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ©
  authentication:
    enabled: true
    method: jwt
    expiry: 24h
    
  # Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„
  accessControl:
    enabled: true
    policies:
      - resource: "/admin/*"
        role: admin
      - resource: "/api/*"
        role: user

# ============================================
# ğŸ“ˆ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ­Ø¬ÙŠÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
# ============================================
autoscaling:
  enabled: true
  minInstances: 1
  maxInstances: 3
  metrics:
    - type: cpu
      threshold: 70
      duration: 5m
    - type: memory
      threshold: 80
      duration: 5m
    - type: requests
      threshold: 100
      duration: 2m

# ============================================
# ğŸ“Š Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
# ============================================
reporting:
  daily:
    enabled: true
    time: "09:00"
    recipients:
      - email: admin@example.com
    
  weekly:
    enabled: true
    day: monday
    time: "10:00"
    
  monthly:
    enabled: true
    day: 1
    time: "11:00"

# ============================================
# ğŸ”„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
# ============================================
backup:
  database:
    enabled: true
    schedule: "0 2 * * *"
    retention: 30
    
  sessions:
    enabled: true
    schedule: "0 3 * * *"
    retention: 7
    
  logs:
    enabled: true
    schedule: "0 4 * * *"
    retention: 90

# ============================================
# ğŸ’° Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙÙˆØªØ±Ø©
# ============================================
billing:
  alertThresholds:
    - amount: 50
      currency: USD
    - amount: 100
      currency: USD
    - amount: 200
      currency: USD
    
  notifications:
    enabled: true
    frequency: weekly

# ============================================
# ğŸ“‹ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù†Ø´Ø±
# ============================================
notes: |
  ğŸ“ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ Render.com:
  
  1. **Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰**: Ø§Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ `render.yaml` ÙÙŠ Ù…Ø´Ø±ÙˆØ¹Ùƒ
  2. **Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©**: Ø§Ø¯ÙØ¹ Ø§Ù„ÙƒÙˆØ¯ Ø¥Ù„Ù‰ GitHub
  3. **Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©**: Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ render.com ÙˆØ£Ù†Ø´Ø¦ Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹
  4. **Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©**: Ø§Ø®ØªØ± "Deploy from Git Repository"
  5. **Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø®Ø§Ù…Ø³Ø©**: Ø§Ø®ØªØ± Ù…Ø³ØªÙˆØ¯Ø¹ GitHub Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
  6. **Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø³Ø§Ø¯Ø³Ø©**: Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Apply" ÙˆØ³ÙŠØ¨Ø¯Ø£ Ø§Ù„Ù†Ø´Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  
  âš ï¸ **Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©**:
  - ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© ÙÙŠ Dashboard
  - ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù„Ø¯ÙŠÙƒ Ø®Ø·Ø·Ø§Ù‹ ÙƒØ§ÙÙŠØ© Ù„Ù„Ù€ Memory ÙˆØ§Ù„Ù€ CPU
  - Ø§Ø³ØªØ®Ø¯Ù… PostgreSQL Ù„Ù„Ø¥Ù†ØªØ§Ø¬ØŒ SQLite Ù„Ù„ØªØ·ÙˆÙŠØ± ÙÙ‚Ø·
  - Ø´ØºÙ„ Health Check Ø¹Ù„Ù‰ `/health`
  
  ğŸ”§ **Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©**:
  - TELEGRAM_BOT_TOKEN: ØªÙˆÙƒÙ† Ø¨ÙˆØª Telegram
  - TELEGRAM_ADMIN_IDS: Ù‚Ø§Ø¦Ù…Ø© Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)
  - DATABASE_URL: Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª PostgreSQL
  
  ğŸ“ **Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯Ø©**:
  - Ø±Ø§Ø¬Ø¹ Ù…Ù„Ù README.md
  - ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Issues ÙÙŠ GitHub
  - Ø§Ø³ØªØ®Ø¯Ù… Ù‚Ù†Ø§Ø© Telegram Ù„Ù„Ø¯Ø¹Ù…
